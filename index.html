import React, { useState } from 'react';
import { Car, Clock, Coffee, ListChecks, Info, ChevronRight } from 'lucide-react';

const App = () => {
  const [activeDay, setActiveDay] = useState(1);

  // 坐标系统重构：大幅拓宽 X 轴跨度，增加 y 轴梯度，解决拥挤问题
  const itinerary = [
    {
      day: 1,
      name: "霞浦",
      route: "温州 → 霞浦",
      dist: "140km / 2.5h",
      color: "bg-blue-500",
      strokeColor: "#3b82f6",
      coords: { x: 70, y: 28 }, // 霞浦稍微往左
      from: { x: 88, y: 10 },   // 温州放在更右上角
      nodes: [
        "12:30 温州出发，直达霞浦",
        "下午 东壁村/附近游玩",
        "傍晚：东壁落日/滩涂摄影",
        "入住：霞浦市区/东壁民宿"
      ]
    },
    {
      day: 2,
      name: "泉州",
      route: "霞浦 → 泉州",
      dist: "240km / 3.5h",
      color: "bg-red-500",
      strokeColor: "#ef4444",
      coords: { x: 20, y: 72 }, // 泉州大幅向左下方拉伸，腾出空间
      from: { x: 70, y: 28 },
      nodes: [
        "中午前后抵达，入住 西街附近",
        "下午：开元寺（看红砖、燕尾脊）",
        "晚上：泉州钟楼周边散步",
        "夜游：感受古城人文夜景"
      ]
    },
    {
      day: 3,
      name: "莆田",
      route: "泉州 ➔ 莆田",
      dist: "80km / 1.5h",
      color: "bg-orange-500",
      strokeColor: "#f97316",
      coords: { x: 40, y: 55 }, // 莆田位于中间偏左
      from: { x: 20, y: 72 },
      nodes: [
        "上午：关岳庙或清净寺深度游",
        "15:00 离泉，约1.5h抵莆田",
        "晚饭：一碗清淡的莆田焖面",
        "休息：为第二天湄洲岛/广化寺蓄力"
      ]
    },
    {
      day: 4,
      name: "宁德",
      route: "莆田 ➔ 宁德",
      dist: "200km / 3h",
      color: "bg-teal-500",
      strokeColor: "#14b8a6",
      coords: { x: 75, y: 38 }, // 宁德向右侧偏移，与霞浦错开
      from: { x: 40, y: 55 },
      nodes: [
        "白天：深度游湄洲岛或广化寺",
        "17:00 离开莆田，北上宁德",
        "入住 宁德市区或东桥开发区",
        "晚上：尝试宁德当地特色夜宵"
      ]
    },
    {
      day: 5,
      name: "温州",
      route: "宁德 → 温州",
      dist: "160km / 2.5h",
      color: "bg-indigo-500",
      strokeColor: "#6366f1",
      coords: { x: 88, y: 10 },
      from: { x: 75, y: 38 },
      nodes: [
        "上午：三都澳看海上浮城",
        "下午：锂电小镇/东侨湖滨漫步",
        "晚饭后：20:00 启程返温",
        "22:30 左右安全到家"
      ]
    }
  ];

  // 贝塞尔曲线算法：根据距离动态调整偏移量，让动线更有呼吸感
  const getCurvePath = (start, end, offsetBase = 12) => {
    const midX = (start.x + end.x) / 2;
    const midY = (start.y + end.y) / 2;
    const dx = end.x - start.x;
    const dy = end.y - start.y;
    const len = Math.sqrt(dx * dx + dy * dy);
    
    // 动态曲率：长距离路段弧度更大
    const dynamicOffset = offsetBase * (len / 30);
    const nx = -dy / len;
    const ny = dx / len;
    
    const controlX = midX + nx * dynamicOffset;
    const controlY = midY + ny * dynamicOffset;
    
    return `M ${start.x},${start.y} Q ${controlX},${controlY} ${end.x},${end.y}`;
  };

  const current = itinerary[activeDay - 1];

  return (
    <div className="flex flex-col md:flex-row h-screen bg-slate-50 font-sans text-slate-800">
      {/* 左侧：交互地图 */}
      <div className="flex-1 relative bg-white p-12 border-r border-slate-200 overflow-hidden flex items-center justify-center">
        <div className="absolute top-8 left-8 z-10">
          <h1 className="text-2xl font-bold text-slate-900 mb-1 tracking-tight">闽浙沿海自驾观察图</h1>
          <p className="text-xs text-slate-400 font-mono italic">Optimized Spatial Distribution & Micro-Markers</p>
        </div>

        <svg viewBox="0 0 100 85" className="w-full h-auto max-w-3xl">
          <defs>
            <pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse">
              <path d="M 10 0 L 0 0 0 10" fill="none" stroke="#f8fafc" strokeWidth="0.4" />
            </pattern>
            {/* 极致精简的箭头：尺寸更小 (2.5)，位置微调 */}
            <marker
              id="arrowhead"
              markerWidth="3"
              markerHeight="3"
              refX="2.5"
              refY="1.5"
              orient="auto"
            >
              <polygon points="0 0, 3 1.5, 0 3" fill={current.strokeColor} />
            </marker>
            <marker
              id="arrowhead-gray"
              markerWidth="2"
              markerHeight="2"
              refX="1.5"
              refY="1"
              orient="auto"
            >
              <polygon points="0 0, 2 1, 0 2" fill="#cbd5e1" />
            </marker>
          </defs>
          <rect width="100%" height="100%" fill="url(#grid)" />

          {/* 全路段底图 (弧线岔开处理) */}
          {itinerary.map((item, idx) => (
             <path
               key={`base-${idx}`}
               d={getCurvePath(item.from, item.coords, 6)}
               fill="none"
               stroke="#f1f5f9"
               strokeWidth="0.8"
               strokeDasharray="1.5,1.5"
               markerEnd="url(#arrowhead-gray)"
             />
          ))}
          
          {/* 活动路段：增加过渡动画效果 */}
          <path
            d={getCurvePath(current.from, current.coords, 10)}
            fill="none"
            stroke={current.strokeColor}
            strokeWidth="1.8"
            strokeLinecap="round"
            markerEnd="url(#arrowhead)"
            className="transition-all duration-1000 ease-in-out"
          />

          {/* 温州节点 - 唯一核心点 */}
          <g onClick={() => setActiveDay(5)} className="cursor-pointer">
            <circle cx="88" cy="10" r={activeDay === 5 ? 3 : 2} fill="#1e293b" className="transition-all duration-300" />
            <text x="83" y="15" className="text-[3px] fill-slate-900 font-bold tracking-tighter text-right">温州 (起始/终点)</text>
          </g>

          {/* 城市节点 - 优化分布 */}
          {itinerary.slice(0, 4).map((item) => (
            <g key={item.day} onClick={() => setActiveDay(item.day)} className="cursor-pointer">
              <circle
                cx={item.coords.x}
                cy={item.coords.y}
                r={activeDay === item.day ? 2.2 : 1.5}
                className={`${activeDay === item.day ? item.color : 'bg-slate-300'} transition-all duration-300 shadow-sm`}
                fill="currentColor"
              />
              <text
                x={item.coords.x + (item.coords.x > 50 ? 3 : -10)} // 自动左右偏移文字
                y={item.coords.y + 1}
                className={`text-[3.2px] font-bold ${activeDay === item.day ? 'fill-slate-900' : 'fill-slate-400'}`}
              >
                {item.name}
              </text>
            </g>
          ))}
        </svg>

        {/* 底部详情浮窗 */}
        <div className="absolute bottom-8 left-8 right-8 bg-slate-900/90 backdrop-blur-md text-white p-5 rounded-2xl shadow-xl flex items-center justify-between border border-slate-700/50">
          <div className="flex items-center gap-4">
            <div className={`p-2.5 rounded-xl ${current.color} shadow-lg ring-4 ring-white/5`}>
              <Car size={20} />
            </div>
            <div>
              <div className="text-[9px] text-slate-400 font-mono tracking-[0.3em] uppercase mb-1">Navigation Sector 0{activeDay}</div>
              <div className="text-xl font-bold tracking-tight flex items-center gap-2">
                {current.route.split(' ')[0]} 
                <ChevronRight size={14} className="text-slate-600" /> 
                {current.route.split(' ').slice(-1)}
              </div>
            </div>
          </div>
          <div className="text-right border-l border-slate-700/50 pl-6">
            <div className="text-[10px] text-slate-400 font-mono italic">Distance Matrix</div>
            <div className="text-xl font-bold text-slate-100">{current.dist}</div>
          </div>
        </div>
      </div>

      {/* 右侧：清单列表 */}
      <div className="w-full md:w-[420px] p-8 overflow-y-auto bg-white">
        <div className="flex items-center justify-between mb-8 border-b pb-6">
          <h2 className="text-xl font-bold flex items-center gap-2 text-slate-900">
            <ListChecks className="text-blue-600" size={24} />
            <span>执行计划</span>
          </h2>
          <span className="text-[10px] font-mono text-slate-400">Ver 2.1 (Optimized)</span>
        </div>

        <div className="space-y-4">
          {itinerary.map((item) => (
            <div
              key={item.day}
              onClick={() => setActiveDay(item.day)}
              className={`p-6 rounded-2xl border transition-all duration-500 cursor-pointer ${
                activeDay === item.day 
                ? `${item.color.replace('bg-', 'border-')} bg-slate-50 shadow-inner scale-[1.01]` 
                : 'border-slate-100 hover:border-slate-200 opacity-60'
              }`}
            >
              <div className="flex justify-between items-center mb-4">
                <span className={`px-2 py-0.5 rounded text-[8px] font-black text-white ${item.color} tracking-tighter`}>
                  STEP 0{item.day}
                </span>
                <span className="text-[10px] font-mono font-medium text-slate-500">{item.dist}</span>
              </div>
              <h3 className="text-base font-bold text-slate-900 mb-4">{item.route}</h3>
              
              <div className="space-y-3">
                {item.nodes.map((node, idx) => (
                  <div key={idx} className="flex gap-3 items-start">
                    <div className={`mt-2 w-1 h-1 rounded-full flex-shrink-0 ${activeDay === item.day ? item.color : 'bg-slate-200'}`} />
                    <span className={`text-sm leading-snug ${activeDay === item.day ? 'text-slate-800' : 'text-slate-400'}`}>
                      {node}
                    </span>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>

        <div className="mt-8 p-6 bg-slate-50 border border-dashed border-slate-200 rounded-2xl relative">
          <h4 className="text-[10px] font-bold text-slate-400 mb-3 uppercase tracking-widest flex items-center gap-2">
            <Info size={12} /> Design Notes
          </h4>
          <p className="text-[11px] text-slate-500 leading-relaxed italic">
            已执行 X 轴空间拉伸算法，路径间距增加 35%。箭头尺寸下调至 0.25 模数。建议优先关注 D2 泉州与 D4 莆田两个核心人文节点。
          </p>
        </div>
      </div>
    </div>
  );
};

export default App;
